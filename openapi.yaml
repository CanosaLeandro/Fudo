openapi: 3.1.1
info:
  title: Fudo API
  version: 1.0.0
  description: API para autenticación y gestión de productos
  contact:
    name: Leandro Joaquín Canosa
    url: https://github.com/canosaleandro
    email: canosa.leandro@gmail.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
tags:
  - name: Auth
    description: Endpoints relacionados con autenticación de usuarios.
  - name: Static
    description: Archivos estáticos y metadatos de la API.
  - name: Products
    description: Gestión y búsqueda de productos.
servers:
  - url: https://api.fudo.com/v1
    description: Producción
  - url: http://localhost:9292/api/v1
    description: Local
security:
  - bearerAuth: []
paths:
  /login:
    post:
      summary: Login de usuario
      description: Autentica un usuario y devuelve un token JWT válido para futuras solicitudes.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user:
                  type: string
                password:
                  type: string
              required:
                - user
                - password
      responses:
        '200':
          description: Token JWT generado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JwtToken'
        '401':
          description: Credenciales inválidas
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      tags:
        - Auth
      operationId: loginUser
  /AUTHORS:
    get:
      summary: Obtener archivo AUTHORS
      description: Devuelve el archivo AUTHORS como texto plano. La respuesta se cachea por 24 horas.
      responses:
        '200':
          description: Archivo AUTHORS
          headers:
            Cache-Control:
              schema:
                type: string
              example: max-age=86400
          content:
            text/plain:
              schema:
                $ref: '#/components/schemas/AuthorsFile'
        '404':
          description: Archivo no encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      tags:
        - Static
      operationId: getAuthorsFile

  /openapi.yaml:
    get:
      summary: Obtener especificación OpenAPI
      description: Devuelve el archivo openapi.yaml. La respuesta nunca se cachea.
      responses:
        '200':
          description: Archivo OpenAPI YAML
          content:
            application/vnd.oai.openapi:
              schema:
                $ref: '#/components/schemas/OpenApiFile'
        '404':
          description: Archivo no encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      tags:
        - Static
      operationId: getOpenApiSpec
  /logout:
    post:
      summary: Logout de usuario
      description: Invalida el token JWT del usuario actual, cerrando la sesión.
      responses:
        '200':
          description: Logout exitoso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LogoutResponse'
        '401':
          description: Token inválido o expirado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      tags:
        - Auth
      operationId: logoutUser
  /product:
    get:
      summary: Buscar producto por nombre
      description: Busca un producto por su nombre usando query params.
      parameters:
        - name: name
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Producto encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '404':
          description: Producto no encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: No autorizado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      tags:
        - Products
      operationId: getProductByName
    post:
      summary: Crear producto
      description: Crea un nuevo producto en la base de datos de manera asíncrona.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                cost:
                  type: number
              required:
                - name
                - cost
      responses:
        '202':
          description: Producto en proceso de creación
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobResponse'
        '401':
          description: No autorizado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      tags:
        - Products
      operationId: createProduct
  /products:
    get:
      summary: Listar productos
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de productos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductsResponse'
        '401':
          description: No autorizado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      tags:
        - Products
      operationId: listProducts
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    JwtToken:
      type: object
      properties:
        token:
          type: string
          description: Devuelve la lista completa de productos registrados.
    ErrorResponse:
      type: object
      properties:
        error:
          type: string
    AuthorsFile:
      type: string
      description: Contenido del archivo AUTHORS
    OpenApiFile:
      type: string
      description: Contenido del archivo openapi.yaml
    LogoutResponse:
      type: object
      properties:
        message:
          type: string
    Product:
      type: object
      required:
        - id
        - name
        - cost
      properties:
        id:
          type: integer
        name:
          type: string
        cost:
          type: number
      example:
        id: 1
        name: "Gaseosa"
        cost: 120.5
    JobResponse:
      type: object
      properties:
        product:
          $ref: '#/components/schemas/Product'
      example:
        product:
          id: 1
          name: "Gaseosa"
          cost: 120.5
    ProductsResponse:
      type: object
      properties:
        products:
          type: array
          items:
            $ref: '#/components/schemas/Product'
      example:
        products:
          - id: 1
            name: "Gaseosa"
            cost: 120.5
          - id: 2
            name: "Lápiz"
            cost: 10.0
